<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Taste That Wine</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="app-shell">
    <header class="topbar">
      <button id="menuToggle" class="menu-toggle" type="button" aria-label="Ouvrir le menu">
        <span class="menu-line"></span>
        <span class="menu-line"></span>
        <span class="menu-line"></span>
      </button>
      <div class="brand">
        <h1>Taste That Wine</h1>
        <p class="subtitle">Ajoute ta quille dans la liste, trouve un verre et commence à déguster !</p>
      </div>
    </header>

    <nav id="drawer" class="drawer" aria-label="Main menu">
      <button class="drawer-link active" type="button" data-nav="wine">Ajouter un vin</button>
      <button class="drawer-link" type="button" data-nav="notes">Notes de dégustation</button>
      <button class="drawer-link" type="button" data-nav="favorites">Favoris</button>
      <button class="drawer-link" type="button" data-nav="leaderboard">Classement</button>
      <button id="resetSessionBtn" class="drawer-link reset-link" type="button">Nouvelle session</button>
    </nav>

    <main class="app">
      <section id="section-wine" class="section active" data-section="wine">
        <div class="card">
          <h2>Ajouter un vin</h2>
          <label>
            Photo de la bouteille
            <input id="bottlePhoto" type="file" accept="image/*" capture="environment" />
          </label>
          

          <div class="grid-two">
            <label>Nom du vin <input id="wineName" type="text" placeholder="Chablis Premier Cru" /></label>
            <label>Domaine <input id="winery" type="text" placeholder="Domaine Exemple" /></label>
            <label>Millésime <input id="vintage" type="text" placeholder="2021" /></label>
            <label>Pays <input id="country" type="text" placeholder="France" /></label>
          </div>

          <button id="addWineBtn" type="button">Ajouter le vin</button>
          <p id="wineStatus" class="status"></p>
        </div>
      </section>

      <section id="section-notes" class="section" data-section="notes">
        <p id="activeSession" class="helper"></p>
        <div class="card" id="sessionCard">
          <h2>Session</h2>
          <label>
            Votre prénom
            <input id="participantName" type="text" placeholder="Ex: Camille" />
          </label>
          <label>
            Code de session
            <input id="sessionCode" type="text" placeholder="Ex: P8K2" />
          </label>
          <button id="joinSessionBtn" type="button">Rejoindre une session</button>
          <p id="sessionStatus" class="status"></p>
        </div>
        <div class="card">
          <h3>Vins en dégustation</h3>
          <div class="table-wrap">
            <table class="wine-table">
              <colgroup>
                <col style="width: 38%" />
                <col style="width: 28%" />
                <col style="width: 14%" />
                <col style="width: 10%" />
                <col style="width: 10%" />
              </colgroup>
              <thead>
                <tr>
                  <th>Vin</th>
                  <th>Domaine</th>
                  <th>Millésime</th>
                  <th>Pays</th>
                  <th>Dégusté</th>
                </tr>
              </thead>
              <tbody id="wineTableBody"></tbody>
            </table>
          </div>
        </div>

        <button id="toLeaderboardBtn" class="section-cta" type="button">Voir le classement</button>

        <div class="card" id="notesCard">
          <div class="notes-header">
            <h2>Notes de dégustation</h2>
            <div class="favorite-row">
              <span class="favorite-label">Coup de coeur</span>
              <button id="favoriteBtn" class="favorite-btn" type="button" aria-label="Coup de coeur">
                <span class="heart-icon" aria-hidden="true">♡</span>
              </button>
            </div>
          </div>
          <div id="selectedWineInfo" class="selected-wine-info">
            <div class="selected-wine-meta">
              <p id="selectedWineName" class="selected-wine-name"></p>
            <p id="selectedWineWinery" class="selected-wine-detail"></p>
            <p id="selectedWineVintage" class="selected-wine-detail"></p>
            <p id="selectedWineCountry" class="selected-wine-detail"></p>
            <a id="selectedWineVivinoLink" class="vivino-link" href="#" target="_blank" rel="noopener noreferrer">Rechercher ce vin sur Vivino</a>
          </div>
          <img id="selectedWineImage" class="selected-wine-photo" alt="Photo du vin sélectionné" />
        </div>
          <label>
            <div class="score-header">
              <span>Score (déplace le curseur)</span>
              <span id="scoreLabel" class="score-label"></span>
              <span id="averageScore" class="average-score">Moyenne : --</span>
            </div>
            <div class="score-row">
              <div class="score-track">
                <input id="score" type="range" min="0" max="100" step="10" value="50" />
                <span id="scoreValue" class="score-bubble">50</span>
              </div>
            </div>
          </label>
          <label>
            Notes
            <textarea id="notes" rows="2" maxlength="200" placeholder="Arômes, bouche, finale, idées d’accords..."></textarea>
            <p id="notesCount" class="notes-count">0 / 200</p>
          </label>
          <p id="ratingStatus" class="status"></p>
        </div>
      </section>

      <section id="section-leaderboard" class="section" data-section="leaderboard">
        <div class="card">
          <div class="leaderboard-header">
            <h2>Classement</h2>
            <button id="refreshLeaderboardBtn" type="button">Rafraîchir</button>
          </div>
          <div class="table-wrap">
            <table class="wine-table">
              <colgroup>
                <col style="width: 46%" />
                <col style="width: 20%" />
                <col style="width: 12%" />
                <col style="width: 11%" />
                <col style="width: 11%" />
              </colgroup>
              <thead>
                <tr>
                  <th>Vin</th>
                  <th>Domaine</th>
                  <th>Moyenne</th>
                  <th>Votes</th>
                  <th>♥</th>
                </tr>
              </thead>
              <tbody id="leaderboardBody"></tbody>
            </table>
          </div>
          <p id="leaderboardStatus" class="status"></p>
        </div>
      </section>

      <section id="section-favorites" class="section" data-section="favorites">
        <div class="card">
          <h2>Favoris</h2>
          <div class="table-wrap">
            <table class="wine-table">
              <colgroup>
                <col style="width: 50%" />
                <col style="width: 30%" />
                <col style="width: 20%" />
              </colgroup>
              <thead>
                <tr>
                  <th>Vin</th>
                  <th>Domaine</th>
                  <th>Millésime</th>
                </tr>
              </thead>
              <tbody id="favoritesBody"></tbody>
            </table>
          </div>
          <p id="favoritesStatus" class="status"></p>
        </div>
      </section>
    </main>
  </div>

  <script>
    window.API_BASE = "https://taste-that-wine-api.gheger.workers.dev";
  </script>
  <div id="imageLightbox" class="lightbox" aria-hidden="true" role="dialog" aria-label="Aperçu de l'image">
    <button id="lightboxClose" class="lightbox-close" type="button" aria-label="Fermer l'image">Fermer</button>
    <img id="lightboxImage" class="lightbox-image" alt="Aperçu du vin" />
  </div>

  <div id="leaderboardModal" class="modal" aria-hidden="true" role="dialog" aria-label="Détails du vin">
      <div class="modal-card">
        <button id="leaderboardModalClose" class="modal-close" type="button" aria-label="Fermer">Fermer</button>
        <div class="selected-wine-info modal-info">
          <img id="modalWineImage" class="selected-wine-photo" alt="Photo du vin" />
          <div class="selected-wine-meta">
            <p id="modalWineName" class="selected-wine-name"></p>
            <p id="modalWineWinery" class="selected-wine-detail"></p>
            <p id="modalWineVintage" class="selected-wine-detail"></p>
            <p id="modalWineCountry" class="selected-wine-detail"></p>
            <p id="modalWineAverage" class="selected-wine-detail"></p>
            <p id="modalWineVotes" class="selected-wine-detail"></p>
            <button id="modalOpenNotesBtn" class="modal-action" type="button">Noter ce vin</button>
            <a id="modalVivinoLink" class="vivino-link" href="#" target="_blank" rel="noopener noreferrer">Rechercher ce vin sur Vivino</a>
          </div>
          <div id="modalNotesList" class="modal-notes"></div>
        </div>
      </div>
  </div>

  <div id="joinNameConflictModal" class="modal" aria-hidden="true" role="dialog" aria-label="Conflit de prénom">
    <div class="modal-card join-conflict-card">
      <p id="joinNameConflictText" class="selected-wine-detail">Il existe déjà un participant avec ce nom</p>
      <div class="join-conflict-actions">
        <button id="joinNameConflictConfirmBtn" class="modal-action" type="button">Oui, c'est moi, rejoindre la session</button>
        <button id="joinNameConflictCancelBtn" class="modal-action" type="button">Je vais choisi un autre prénom</button>
      </div>
    </div>
  </div>

  <script src="app.js" defer></script>
</body>
</html>
